var Pe=Object.defineProperty;var Ie=(n,e,t)=>e in n?Pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var d=(n,e,t)=>(Ie(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();var W=function(n,e){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])},W(n,e)};function _(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");W(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function X(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return i}function I(n,e,t){if(t||arguments.length===2)for(var r=0,o=e.length,i;r<o;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}function w(n){return typeof n=="function"}function ge(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var H=ge(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,o){return o+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function $(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var U=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=X(s),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(h){e={error:h}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var v=this.initialTeardown;if(w(v))try{v()}catch(h){i=h instanceof H?h.errors:[h]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var b=X(p),y=b.next();!y.done;y=b.next()){var S=y.value;try{fe(S)}catch(h){i=i??[],h instanceof H?i=I(I([],P(i)),P(h.errors)):i.push(h)}}}catch(h){r={error:h}}finally{try{y&&!y.done&&(o=b.return)&&o.call(b)}finally{if(r)throw r.error}}}if(i)throw new H(i)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)fe(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&$(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&$(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),we=U.EMPTY;function Se(n){return n instanceof U||n&&"closed"in n&&w(n.remove)&&w(n.add)&&w(n.unsubscribe)}function fe(n){w(n)?n():n.unsubscribe()}var _e={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Z={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=Z.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,I([n,e],P(t))):setTimeout.apply(void 0,I([n,e],P(t)))},clearTimeout:function(n){var e=Z.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function De(n){Z.setTimeout(function(){throw n})}function de(){}function F(n){n()}var te=function(n){_(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Se(t)&&t.add(r)):r.destination=Ue,r}return e.create=function(t,r,o){return new N(t,r,o)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(U),Be=Function.prototype.bind;function K(n,e){return Be.call(n,e)}var Re=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){L(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){L(r)}else L(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){L(t)}},n}(),N=function(n){_(e,n);function e(t,r,o){var i=n.call(this)||this,s;if(w(t)||!t)s={next:t??void 0,error:r??void 0,complete:o??void 0};else{var a;i&&_e.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return i.unsubscribe()},s={next:t.next&&K(t.next,a),error:t.error&&K(t.error,a),complete:t.complete&&K(t.complete,a)}):s=t}return i.destination=new Re(s),i}return e}(te);function L(n){De(n)}function ke(n){throw n}var Ue={closed:!0,next:de,error:ke,complete:de},je=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ee(n){return n}function Me(n){return n.length===0?Ee:n.length===1?n[0]:function(t){return n.reduce(function(r,o){return o(r)},t)}}var ee=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var o=this,i=Le(e)?e:new N(e,t,r);return F(function(){var s=o,a=s.operator,c=s.source;i.add(a?a.call(i,c):c?o._subscribe(i):o._trySubscribe(i))}),i},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=pe(t),new t(function(o,i){var s=new N({next:function(a){try{e(a)}catch(c){i(c),s.unsubscribe()}},error:i,complete:o});r.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[je]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Me(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=pe(e),new e(function(r,o){var i;t.subscribe(function(s){return i=s},function(s){return o(s)},function(){return r(i)})})},n.create=function(e){return new n(e)},n}();function pe(n){var e;return(e=n??_e.Promise)!==null&&e!==void 0?e:Promise}function qe(n){return n&&w(n.next)&&w(n.error)&&w(n.complete)}function Le(n){return n&&n instanceof te||qe(n)&&Se(n)}function Fe(n){return w(n==null?void 0:n.lift)}function ne(n){return function(e){if(Fe(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function re(n,e,t,r,o){return new $e(n,e,t,r,o)}var $e=function(n){_(e,n);function e(t,r,o,i,s,a){var c=n.call(this,t)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(u){try{r(u)}catch(v){t.error(v)}}:n.prototype._next,c._error=i?function(u){try{i(u)}catch(v){t.error(v)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=o?function(){try{o()}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(te),Ve=ge(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),oe=function(n){_(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new he(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ve},e.prototype.next=function(t){var r=this;F(function(){var o,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=X(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(t)}}catch(u){o={error:u}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},e.prototype.error=function(t){var r=this;F(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var o=r.observers;o.length;)o.shift().error(t)}})},e.prototype.complete=function(){var t=this;F(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,o=this,i=o.hasError,s=o.isStopped,a=o.observers;return i||s?we:(this.currentObservers=null,a.push(t),new U(function(){r.currentObservers=null,$(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,o=r.hasError,i=r.thrownError,s=r.isStopped;o?t.error(i):s&&t.complete()},e.prototype.asObservable=function(){var t=new ee;return t.source=this,t},e.create=function(t,r){return new he(t,r)},e}(ee),he=function(n){_(e,n);function e(t,r){var o=n.call(this)||this;return o.destination=t,o.source=r,o}return e.prototype.next=function(t){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,t)},e.prototype.error=function(t){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&o!==void 0?o:we},e}(oe),Qe=function(n){_(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,o=t.thrownError,i=t._value;if(r)throw o;return this._throwIfClosed(),i},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(oe),Ae={now:function(){return(Ae.delegate||Date).now()},delegate:void 0},Ye=function(n){_(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(U),V={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=V.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,I([n,e],P(t))):setInterval.apply(void 0,I([n,e],P(t)))},clearInterval:function(n){var e=V.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},He=function(n){_(e,n);function e(t,r){var o=n.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.pending=!1,o}return e.prototype.schedule=function(t,r){var o;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(t,r,o){return o===void 0&&(o=0),V.setInterval(t.flush.bind(t,this),o)},e.prototype.recycleAsyncId=function(t,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&V.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(t,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var o=!1,i;try{this.work(t)}catch(s){o=!0,i=s||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,o=t.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,$(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(Ye),ve=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=Ae.now,n}(),Ke=function(n){_(e,n);function e(t,r){r===void 0&&(r=ve.now);var o=n.call(this,t,r)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var o;this._active=!0;do if(o=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,o){for(;t=r.shift();)t.unsubscribe();throw o}},e}(ve),Ce=new Ke(He),ze=Ce;function Je(n){return n&&w(n.schedule)}function We(n){return n instanceof Date&&!isNaN(n)}function ie(n,e){return ne(function(t,r){var o=0;t.subscribe(re(r,function(i){r.next(n.call(e,i,o++))}))})}function Xe(n,e,t){n===void 0&&(n=0),t===void 0&&(t=ze);var r=-1;return e!=null&&(Je(e)?t=e:r=e),new ee(function(o){var i=We(n)?+n-t.now():n;i<0&&(i=0);var s=0;return t.schedule(function(){o.closed||(o.next(s++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function Ze(n,e){return n===void 0&&(n=0),e===void 0&&(e=Ce),n<0&&(n=0),Xe(n,n,e)}function j(n,e){return ne(function(t,r){var o=0;t.subscribe(re(r,function(i){return n.call(e,i,o++)&&r.next(i)}))})}function se(n,e){return e===void 0&&(e=Ee),n=n??Ne,ne(function(t,r){var o,i=!0;t.subscribe(re(r,function(s){var a=e(s);(i||!n(o,a))&&(i=!1,o=a,r.next(s))}))})}function Ne(n,e){return n===e}class ae extends RTCSessionDescription{constructor(e){super(e)}}class ce extends RTCIceCandidate{constructor(e){super(e)}}class O extends RTCSessionDescription{constructor(e){super(e)}}const Oe=new Map;function et(n,e){Oe.set(n,e)}function tt(n){const e=Oe.get(n);if(!e)throw new Error(`O tipo ${n.name} não está registrado`);return new e}const nt=n=>{const e=new Qe(n),t=()=>e.getValue();return{value$:e.asObservable(),select:c=>e.asObservable().pipe(ie(u=>c(u)),se()),value:t,patch:c=>{e.next({...t(),...c})},update:(c,u)=>{e.next({...t(),[c]:u})},set:c=>e.next(c)}},R=class R{constructor(){d(this,"map",new Map);d(this,"_events",new oe);d(this,"events$",this._events.asObservable());d(this,"name",crypto.randomUUID())}static incSeq(){this._SEQ++}static get SEQ(){return this._SEQ}on(e,t){this.map.set(e,t)}log(...e){R.incSeq(),console.log(`${R.SEQ}.`,...e)}};d(R,"_SEQ",0);let A=R;const rt={ice:{new:"Até agora nenhum par foi encontrado, tentarei uma nova oferta",checking:`Recebi um candidato remoto e estou verificando pares para ele, mas ainda não encontrei uma conexão...
    Ou as verificações de consentimento (RFC7675) falharam em todos os pares de candidatos anteriormente bem-sucedidos.
    Vou verificar e continuar reunindo informações`,disconnected:"Perdemos o transporte para estabelecer conexão, parece que a rede está instável",closed:"Perdemos o transporte para estabelecer conexão, parece que a rede está instável",failed:`Recebi a informação de que não há mais candidatos remotos, a verificação de todos os pares de candidatos
    e todos os pares falharam nas verificações de conectividade ou perderam o consentimento e nenhum candidato local foi coletado.
    Vou tentar uma nova oferta reiniciando o transporte para uma nova tentativa de busca por pares...`,completed:"Não há mais candidatos de transporte, a verificação foi concluída e encontramos um par",connected:"Encontramos um transporte utilizável, estamos conectados mas ainda estarei em busca de outros..."}};function g(n,e={},...t){const r=Object.assign(document.createElement(n),e);return r.append(...t),r}const ot=n=>e=>{const t=new Date().toLocaleTimeString();n.append(g("dt",{innerText:t}),g("dd",{innerText:e}))},it=["have-remote-offer","have-local-pranswer"],st=n=>it.includes(n);function at(n,e=1){const t=parseInt(n.slice(1,3),16),r=parseInt(n.slice(3,5),16),o=parseInt(n.slice(5,7),16);return`rgba(${t},${r},${o},${e})`}const ct=(n,{color:e,opacity:t}={color:"#ffffff",opacity:.16})=>{const r=document.createElement("canvas"),o=new AudioContext,i=r.getContext("2d");i.fillStyle=at(e,t);const s=o.createMediaStreamSource(n),a=o.createAnalyser();s.connect(a);const c=a.frequencyBinCount,u=new Uint8Array(c);let v,p,b,y;const{width:S,height:h}=r,T=()=>{if(i&&n){i.clearRect(0,0,S,h),v=S;for(let m=0;m<v;m++)b=S/v,p=m*(b+2),y=-u[m]/1.6,i.fillRect(p,h,b,y)}};let E=-1;const C=()=>{E=requestAnimationFrame(C),a.getByteFrequencyData(u),T()};return{canvas:r,renderLoop:C,animationFrame:E,disable:()=>{n.getTracks().forEach(m=>m.enabled=!1),cancelAnimationFrame(E),o.suspend()}}},ut=async(n,e)=>{const t=await n.createAnswer(e);return await n.setLocalDescription(t),t},k=async(n,e)=>{const t=await n.createOffer(e);return await n.setLocalDescription(t),t};function ue(...n){const e=t=>!!n.find(r=>t instanceof r);return t=>t.pipe(j(e))}function lt(n=-3,e=3){return Math.random()*(e-n)+n}const ft=n=>document.querySelector(n),dt=n=>navigator.mediaDevices.getUserMedia(n||{audio:!0});function be(n,e,t,r){const o=e*n.sampleRate,i=(e-2*t)*n.sampleRate,s=o+i,a=n.createBuffer(1,s,n.sampleRate),c=a.getChannelData(0);for(let u=0;u<o;++u)r?c[u]=(o-u)/s:c[u]=u/o;for(let u=o;u<s;++u)c[u]=0;return a}function pt(n,e,t){const r=e*n.sampleRate,o=(e-2*t)*n.sampleRate,i=r+o,s=n.createBuffer(1,i,n.sampleRate),a=s.getChannelData(0),c=t*n.sampleRate,u=c,v=r-c;for(let p=0;p<r;++p){let b;p<u?b=Math.sqrt(p/c):p>=v?b=Math.sqrt(1-(p-v)/c):b=1,a[p]=b}for(let p=r;p<i;++p)a[p]=0;return s}class ht{constructor(e,t=.1,r=.05,o=.1){d(this,"input");d(this,"output");d(this,"shiftDownBuffer");d(this,"shiftUpBuffer");d(this,"mod1");d(this,"mod2");d(this,"mod1Gain");d(this,"mod2Gain");d(this,"mod3Gain");d(this,"mod4Gain");d(this,"modGain1");d(this,"modGain2");d(this,"fade1");d(this,"fade2");d(this,"mix1");d(this,"mix2");d(this,"delay1");d(this,"delay2");this.context=e,this.bufferTime=t,this.fadeTime=r,this.delayTime=o;const i=e.createGain(),s=e.createGain();this.input=i,this.output=s;const a=e.createBufferSource(),c=e.createBufferSource(),u=e.createBufferSource(),v=e.createBufferSource();this.shiftDownBuffer=be(e,t,r,!1),this.shiftUpBuffer=be(e,t,r,!0),a.buffer=this.shiftDownBuffer,c.buffer=this.shiftDownBuffer,u.buffer=this.shiftUpBuffer,v.buffer=this.shiftUpBuffer,a.loop=!0,c.loop=!0,u.loop=!0,v.loop=!0;const p=e.createGain(),b=e.createGain(),y=e.createGain();y.gain.value=0;const S=e.createGain();S.gain.value=0,a.connect(p),c.connect(b),u.connect(y),v.connect(S);const h=e.createGain(),T=e.createGain(),E=e.createDelay(),C=e.createDelay();p.connect(h),b.connect(T),y.connect(h),S.connect(T),h.connect(E.delayTime),T.connect(C.delayTime);const x=e.createBufferSource(),m=e.createBufferSource(),le=pt(e,t,r);x.buffer=le,m.buffer=le,x.loop=!0,m.loop=!0;const D=e.createGain(),B=e.createGain();D.gain.value=0,B.gain.value=0,x.connect(D.gain),m.connect(B.gain),i.connect(E),i.connect(C),E.connect(D),C.connect(B),D.connect(s),B.connect(s);const q=e.currentTime+.05,Y=q+t-r;a.start(q),c.start(Y),u.start(q),v.start(Y),x.start(q),m.start(Y),this.mod1=a,this.mod2=c,this.mod1Gain=p,this.mod2Gain=b,this.mod3Gain=y,this.mod4Gain=S,this.modGain1=h,this.modGain2=T,this.fade1=x,this.fade2=m,this.mix1=D,this.mix2=B,this.delay1=E,this.delay2=C,this.setDelay(o)}setDelay(e){this.modGain1.gain.setTargetAtTime(.5*e,0,.01),this.modGain2.gain.setTargetAtTime(.5*e,0,.01)}setPitchOffset(e){e>0?(this.mod1Gain.gain.value=0,this.mod2Gain.gain.value=0,this.mod3Gain.gain.value=1,this.mod4Gain.gain.value=1):(this.mod1Gain.gain.value=1,this.mod2Gain.gain.value=1,this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0),this.setDelay(this.delayTime*Math.abs(e))}}const vt=n=>{const e=new AudioContext,t=e.createMediaStreamSource(n),r=e.createDelay();r.delayTime.value=0,t.connect(r);const o=new ht(e);o.setPitchOffset(1.6),r.connect(o.input);const i=e.createMediaStreamDestination();o.output.connect(i);const s=document.createElement("input");return s.type="range",s.min="-3",s.max="3",s.value=String(lt(-3,3)),s.oninput=()=>{o.setPitchOffset(s.valueAsNumber)},{input:s,destination:i}};class bt extends A{constructor(){super();d(this,"provider",new BroadcastChannel("signaling"));this.provider.onmessage=({data:t})=>{if(t.name!==this.name){A.incSeq();const r=this.map.get(t.type);this._events.next(new r(t.payload))}}}onOpen(t){t(new CustomEvent("open"))}emit(t,r){A.incSeq(),this.provider.postMessage({sequence:A.SEQ,payload:r.toJSON(),name:this.name,type:t})}}et(A,bt);const l=tt(A);l.on("offer",O);l.on("answer",ae);l.on("candidate",ce);const z=new MediaStream,Te=g("dl",{id:"log"}),yt=ot(Te);document.body.append(Te);const f=new RTCPeerConnection,xe={autoplay:!0},J=g("audio",xe),G=g("audio",xe),Ge=g("output",{innerText:"guentae, rapidão"});document.body.appendChild(Ge);f.onicecandidate=n=>{if(n.candidate){const e=new ce(n.candidate);l.emit("candidate",e),l.log("Enviei meus candidatos")}};const M=nt({signaling:"closed",connection:"new",iceConnection:"closed",iceGathering:"new"});f.onsignalingstatechange=()=>{M.update("signaling",f.signalingState)};f.oniceconnectionstatechange=()=>{M.update("iceConnection",f.iceConnectionState)};f.onconnectionstatechange=()=>{M.update("connection",f.connectionState),Ge.innerText=f.connectionState};f.onicegatheringstatechange=()=>{M.update("iceGathering",f.iceGatheringState)};l.events$.pipe(ue(O),ie(async n=>(l.log("Recebi uma oferta"),await f.setRemoteDescription(n),l.log("Configurei uma descrição remota"),n))).subscribe(async n=>{if(await n,st(f.signalingState)){l.log("Aceitei uma oferta");const e=await ut(f);l.log("Configurei uma descrição local"),l.emit("answer",new ae(e)),l.log("Enviei uma resposta")}});l.events$.pipe(ue(ae)).subscribe(async n=>{l.log("Recebi uma resposta"),f.setRemoteDescription(n),l.log("Configurei uma descrição remota")});l.events$.pipe(ue(ce)).subscribe(async n=>{f.remoteDescription&&await f.addIceCandidate(n)});f.onnegotiationneeded=async()=>{l.log("Vamos negociar"),l.onOpen(async()=>{const n=await k(f);l.emit("offer",new O(n)),l.log("Enviei uma oferta")})};const Q=M.select(n=>n.connection),mt=Q.pipe(j(n=>n==="connected")),gt=Q.pipe(j(n=>n==="disconnected"),se((n,e)=>n!=="disconnected"&&e==="connecting")),wt=Q.pipe(j(n=>n==="disconnected"),se((n,e)=>n!=="disconnected"&&e==="disconnected")),St=Q.pipe(j(n=>n==="disconnected"));mt.subscribe(()=>{document.body.appendChild(G),G.paused&&G.play()});St.subscribe(()=>{G.remove()});gt.subscribe(async()=>{const n=await k(f);l.emit("offer",new O(n)),l.log("Fomos desconectados, enviei uma nova oferta")});wt.subscribe(async()=>{const n=await k(f);l.emit("offer",new O(n)),l.log("Fomos desconectados, enviei uma nova oferta")});let ye="";Ze(1e3*20).pipe(ie(()=>f.iceConnectionState)).subscribe(async n=>{if(n){const e=rt.ice[n];ye!==e&&(yt(e),ye=e),ft("dd:last-child").scrollIntoView({behavior:"smooth",block:"end"})}switch(n){case"new":{const e=await k(f);l.emit("offer",new O(e)),l.log("Enviei uma nova oferta");break}case"failed":{const t=await k(f,{iceRestart:!0});l.emit("offer",new O(t)),l.log("Enviei uma oferta");break}}});f.ontrack=({track:n})=>{if(n){z.addTrack(n),G.srcObject=z,G.autoplay=!0;const e=ct(z);document.body.appendChild(e.canvas),e.renderLoop()}};dt().then(n=>{J.srcObject=n,J.muted=!0,document.body.appendChild(J);const{input:e,destination:t}=vt(n),[r]=t.stream.getAudioTracks();f.addTrack(r);const o=g("h2",{innerText:"🧌",ariaLabel:"Monstro",title:"Monstro"}),i=g("h2",{innerText:"🐩",ariaLabel:"Poodle",title:"Poodle"}),s=g("section");s.append(o,e,i),document.body.appendChild(s);const a=g("input",{type:"checkbox",id:"pitch"});a.onchange=()=>{if(a.checked){const[u]=n.getAudioTracks();me(u)}else{const[u]=t.stream.getAudioTracks();me(u)}},queueMicrotask(()=>a.click());const c=g("label",{htmlFor:"pitch",innerText:"Pitch",title:"Pitch"},a);document.body.append(c)});const me=n=>{const e=f.getSenders().find(({track:t})=>t&&t.kind==="audio");e==null||e.replaceTrack(n)};url.innerText=location.href;url.title="Clique para copiar";url.style.cursor="pointer";url.onclick=n=>{n.preventDefault(),navigator.clipboard.writeText(location.href);const e=g("small",{innerText:"Copiado..."});url.after(e),setTimeout(()=>e.remove(),1e3)};
