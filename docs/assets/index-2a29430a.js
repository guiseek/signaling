var Ne=Object.defineProperty;var et=(e,t,n)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var y=(e,t,n)=>(et(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var ie=function(e,t){return ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},ie(e,t)};function _(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");ie(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function tt(e,t,n,r){function o(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function s(f){try{c(r.next(f))}catch(d){a(d)}}function u(f){try{c(r.throw(f))}catch(d){a(d)}}function c(f){f.done?i(f.value):o(f.value).then(s,u)}c((r=r.apply(e,t||[])).next())})}function Oe(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(f){return u([c,f])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(n=0)),n;)try{if(r=1,o&&(i=c[0]&2?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,o=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){n.label=c[1];break}if(c[0]===6&&n.label<i[1]){n.label=i[1],i=c;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(c);break}i[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(f){c=[6,f],o=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function B(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function L(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],a;try{for(;(t===void 0||t-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return i}function U(e,t,n){if(n||arguments.length===2)for(var r=0,o=t.length,i;r<o;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function R(e){return this instanceof R?(this.v=e,this):new R(e)}function nt(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),o,i=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(l){r[l]&&(o[l]=function(m){return new Promise(function(g,p){i.push([l,m,g,p])>1||s(l,m)})})}function s(l,m){try{u(r[l](m))}catch(g){d(i[0][3],g)}}function u(l){l.value instanceof R?Promise.resolve(l.value.v).then(c,f):d(i[0][2],l)}function c(l){s("next",l)}function f(l){s("throw",l)}function d(l,m){l(m),i.shift(),i.length&&s(i[0][0],i[0][1])}}function rt(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof B=="function"?B(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=e[i]&&function(a){return new Promise(function(s,u){a=e[i](a),o(s,u,a.done,a.value)})}}function o(i,a,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},a)}}function b(e){return typeof e=="function"}function Te(e){var t=function(r){Error.call(r),r.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var te=Te(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,o){return o+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function z(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var V=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,r,o,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=B(a),u=s.next();!u.done;u=s.next()){var c=u.value;c.remove(this)}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}else a.remove(this);var f=this.initialTeardown;if(b(f))try{f()}catch(p){i=p instanceof te?p.errors:[p]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var l=B(d),m=l.next();!m.done;m=l.next()){var g=m.value;try{we(g)}catch(p){i=i??[],p instanceof te?i=U(U([],L(i)),L(p.errors)):i.push(p)}}}catch(p){r={error:p}}finally{try{m&&!m.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}if(i)throw new te(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)we(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&z(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&z(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Ce=V.EMPTY;function Pe(e){return e instanceof V||e&&"closed"in e&&b(e.remove)&&b(e.add)&&b(e.unsubscribe)}function we(e){b(e)?e():e.unsubscribe()}var Ge={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ae={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=ae.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,U([e,t],L(n))):setTimeout.apply(void 0,U([e,t],L(n)))},clearTimeout:function(e){var t=ae.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ke(e){ae.setTimeout(function(){throw e})}function ce(){}function X(e){e()}var ue=function(e){_(t,e);function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Pe(n)&&n.add(r)):r.destination=ct,r}return t.create=function(n,r,o){return new se(n,r,o)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(V),ot=Function.prototype.bind;function ne(e,t){return ot.call(e,t)}var it=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){W(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){W(r)}else W(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){W(n)}},e}(),se=function(e){_(t,e);function t(n,r,o){var i=e.call(this)||this,a;if(b(n)||!n)a={next:n??void 0,error:r??void 0,complete:o??void 0};else{var s;i&&Ge.useDeprecatedNextContext?(s=Object.create(n),s.unsubscribe=function(){return i.unsubscribe()},a={next:n.next&&ne(n.next,s),error:n.error&&ne(n.error,s),complete:n.complete&&ne(n.complete,s)}):a=n}return i.destination=new it(a),i}return t}(ue);function W(e){ke(e)}function at(e){throw e}var ct={closed:!0,next:ce,error:at,complete:ce},le=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function fe(e){return e}function st(e){return e.length===0?fe:e.length===1?e[0]:function(n){return e.reduce(function(r,o){return o(r)},n)}}var S=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var o=this,i=lt(t)?t:new se(t,n,r);return X(function(){var a=o,s=a.operator,u=a.source;i.add(s?s.call(i,u):u?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return n=Se(n),new n(function(o,i){var a=new se({next:function(s){try{t(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});r.subscribe(a)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[le]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return st(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=Se(t),new t(function(r,o){var i;n.subscribe(function(a){return i=a},function(a){return o(a)},function(){return r(i)})})},e.create=function(t){return new e(t)},e}();function Se(e){var t;return(t=e??Ge.Promise)!==null&&t!==void 0?t:Promise}function ut(e){return e&&b(e.next)&&b(e.error)&&b(e.complete)}function lt(e){return e&&e instanceof ue||ut(e)&&Pe(e)}function ft(e){return b(e==null?void 0:e.lift)}function P(e){return function(t){if(ft(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function C(e,t,n,r,o){return new dt(e,t,n,r,o)}var dt=function(e){_(t,e);function t(n,r,o,i,a,s){var u=e.call(this,n)||this;return u.onFinalize=a,u.shouldUnsubscribe=s,u._next=r?function(c){try{r(c)}catch(f){n.error(f)}}:e.prototype._next,u._error=i?function(c){try{i(c)}catch(f){n.error(f)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=o?function(){try{o()}catch(c){n.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,u}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(ue),ht=Te(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),de=function(e){_(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var r=new Ee(this,this);return r.operator=n,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new ht},t.prototype.next=function(n){var r=this;X(function(){var o,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var a=B(r.currentObservers),s=a.next();!s.done;s=a.next()){var u=s.value;u.next(n)}}catch(c){o={error:c}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}}})},t.prototype.error=function(n){var r=this;X(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var o=r.observers;o.length;)o.shift().error(n)}})},t.prototype.complete=function(){var n=this;X(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var r=this,o=this,i=o.hasError,a=o.isStopped,s=o.observers;return i||a?Ce:(this.currentObservers=null,s.push(n),new V(function(){r.currentObservers=null,z(s,n)}))},t.prototype._checkFinalizedStatuses=function(n){var r=this,o=r.hasError,i=r.thrownError,a=r.isStopped;o?n.error(i):a&&n.complete()},t.prototype.asObservable=function(){var n=new S;return n.source=this,n},t.create=function(n,r){return new Ee(n,r)},t}(S),Ee=function(e){_(t,e);function t(n,r){var o=e.call(this)||this;return o.destination=n,o.source=r,o}return t.prototype.next=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,n)},t.prototype.error=function(n){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,n)},t.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},t.prototype._subscribe=function(n){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&o!==void 0?o:Ce},t}(de),pt=function(e){_(t,e);function t(n){var r=e.call(this)||this;return r._value=n,r}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(n){var r=e.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},t.prototype.getValue=function(){var n=this,r=n.hasError,o=n.thrownError,i=n._value;if(r)throw o;return this._throwIfClosed(),i},t.prototype.next=function(n){e.prototype.next.call(this,this._value=n)},t}(de),Re={now:function(){return(Re.delegate||Date).now()},delegate:void 0},vt=function(e){_(t,e);function t(n,r){return e.call(this)||this}return t.prototype.schedule=function(n,r){return this},t}(V),Z={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Z.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,U([e,t],L(n))):setInterval.apply(void 0,U([e,t],L(n)))},clearInterval:function(e){var t=Z.delegate;return((t==null?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},yt=function(e){_(t,e);function t(n,r){var o=e.call(this,n,r)||this;return o.scheduler=n,o.work=r,o.pending=!1,o}return t.prototype.schedule=function(n,r){var o;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,r),this},t.prototype.requestAsyncId=function(n,r,o){return o===void 0&&(o=0),Z.setInterval(n.flush.bind(n,this),o)},t.prototype.recycleAsyncId=function(n,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&Z.clearInterval(r)},t.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,r){var o=!1,i;try{this.work(n)}catch(a){o=!0,i=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,o=n.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,z(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(vt),Ae=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(r,n)},e.now=Re.now,e}(),mt=function(e){_(t,e);function t(n,r){r===void 0&&(r=Ae.now);var o=e.call(this,n,r)||this;return o.actions=[],o._active=!1,o}return t.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,o){for(;n=r.shift();)n.unsubscribe();throw o}},t}(Ae),he=new mt(yt),bt=he,gt=new S(function(e){return e.complete()});function De(e){return e&&b(e.schedule)}function wt(e){return e[e.length-1]}function St(e){return De(wt(e))?e.pop():void 0}var Be=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Le(e){return b(e==null?void 0:e.then)}function Ue(e){return b(e[le])}function Me(e){return Symbol.asyncIterator&&b(e==null?void 0:e[Symbol.asyncIterator])}function je(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Et(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var qe=Et();function $e(e){return b(e==null?void 0:e[qe])}function Fe(e){return nt(this,arguments,function(){var n,r,o,i;return Oe(this,function(a){switch(a.label){case 0:n=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,R(n.read())];case 3:return r=a.sent(),o=r.value,i=r.done,i?[4,R(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,R(o)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Ve(e){return b(e==null?void 0:e.getReader)}function M(e){if(e instanceof S)return e;if(e!=null){if(Ue(e))return At(e);if(Be(e))return It(e);if(Le(e))return xt(e);if(Me(e))return Ye(e);if($e(e))return _t(e);if(Ve(e))return Ot(e)}throw je(e)}function At(e){return new S(function(t){var n=e[le]();if(b(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function It(e){return new S(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function xt(e){return new S(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,ke)})}function _t(e){return new S(function(t){var n,r;try{for(var o=B(e),i=o.next();!i.done;i=o.next()){var a=i.value;if(t.next(a),t.closed)return}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}t.complete()})}function Ye(e){return new S(function(t){Tt(e,t).catch(function(n){return t.error(n)})})}function Ot(e){return Ye(Fe(e))}function Tt(e,t){var n,r,o,i;return tt(this,void 0,void 0,function(){var a,s;return Oe(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),n=rt(e),u.label=1;case 1:return[4,n.next()];case 2:if(r=u.sent(),!!r.done)return[3,4];if(a=r.value,t.next(a),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),o={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function T(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=!1);var i=t.schedule(function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(i),!o)return i}function Qe(e,t){return t===void 0&&(t=0),P(function(n,r){n.subscribe(C(r,function(o){return T(r,e,function(){return r.next(o)},t)},function(){return T(r,e,function(){return r.complete()},t)},function(o){return T(r,e,function(){return r.error(o)},t)}))})}function He(e,t){return t===void 0&&(t=0),P(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Ct(e,t){return M(e).pipe(He(t),Qe(t))}function Pt(e,t){return M(e).pipe(He(t),Qe(t))}function Gt(e,t){return new S(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function kt(e,t){return new S(function(n){var r;return T(n,t,function(){r=e[qe](),T(n,t,function(){var o,i,a;try{o=r.next(),i=o.value,a=o.done}catch(s){n.error(s);return}a?n.complete():n.next(i)},0,!0)}),function(){return b(r==null?void 0:r.return)&&r.return()}})}function Ke(e,t){if(!e)throw new Error("Iterable cannot be null");return new S(function(n){T(n,t,function(){var r=e[Symbol.asyncIterator]();T(n,t,function(){r.next().then(function(o){o.done?n.complete():n.next(o.value)})},0,!0)})})}function Rt(e,t){return Ke(Fe(e),t)}function Dt(e,t){if(e!=null){if(Ue(e))return Ct(e,t);if(Be(e))return Gt(e,t);if(Le(e))return Pt(e,t);if(Me(e))return Ke(e,t);if($e(e))return kt(e,t);if(Ve(e))return Rt(e,t)}throw je(e)}function Bt(e,t){return t?Dt(e,t):M(e)}function Lt(e){return e instanceof Date&&!isNaN(e)}function Y(e,t){return P(function(n,r){var o=0;n.subscribe(C(r,function(i){r.next(e.call(t,i,o++))}))})}function Ut(e,t,n,r,o,i,a,s){var u=[],c=0,f=0,d=!1,l=function(){d&&!u.length&&!c&&t.complete()},m=function(p){return c<r?g(p):u.push(p)},g=function(p){i&&t.next(p),c++;var x=!1;M(n(p,f++)).subscribe(C(t,function(w){o==null||o(w),i?m(w):t.next(w)},function(){x=!0},void 0,function(){if(x)try{c--;for(var w=function(){var E=u.shift();a?T(t,a,function(){return g(E)}):g(E)};u.length&&c<r;)w();l()}catch(E){t.error(E)}}))};return e.subscribe(C(t,m,function(){d=!0,l()})),function(){s==null||s()}}function pe(e,t,n){return n===void 0&&(n=1/0),b(t)?pe(function(r,o){return Y(function(i,a){return t(r,i,o,a)})(M(e(r,o)))},n):(typeof t=="number"&&(n=t),P(function(r,o){return Ut(r,o,e,n)}))}function Mt(e){return e===void 0&&(e=1/0),pe(fe,e)}function jt(){return Mt(1)}function qt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jt()(Bt(e,St(e)))}function We(e,t,n){e===void 0&&(e=0),n===void 0&&(n=bt);var r=-1;return t!=null&&(De(t)?n=t:r=t),new S(function(o){var i=Lt(e)?+e-n.now():e;i<0&&(i=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function $t(e,t){return e===void 0&&(e=0),t===void 0&&(t=he),e<0&&(e=0),We(e,e,t)}function Q(e,t){return P(function(n,r){var o=0;n.subscribe(C(r,function(i){return e.call(t,i,o++)&&r.next(i)}))})}function Ie(e){return e<=0?function(){return gt}:P(function(t,n){var r=0;t.subscribe(C(n,function(o){++r<=e&&(n.next(o),e<=r&&n.complete())}))})}function Ft(){return P(function(e,t){e.subscribe(C(t,ce))})}function Vt(e){return Y(function(){return e})}function Je(e,t){return t?function(n){return qt(t.pipe(Ie(1),Ft()),n.pipe(Je(e)))}:pe(function(n,r){return M(e(n,r)).pipe(Ie(1),Vt(n))})}function Yt(e,t){t===void 0&&(t=he);var n=We(e,t);return Je(function(){return n})}function ve(e,t){return t===void 0&&(t=fe),e=e??Qt,P(function(n,r){var o,i=!0;n.subscribe(C(r,function(a){var s=t(a);(i||!e(o,s))&&(i=!1,o=s,r.next(a))}))})}function Qt(e,t){return e===t}class ye extends RTCSessionDescription{constructor(t){super(t)}}class me extends RTCIceCandidate{constructor(t){super(t)}}class G extends RTCSessionDescription{constructor(t){super(t)}}const Xe=new Map;function Ht(e,t){Xe.set(e,t)}function Kt(e){const t=Xe.get(e);if(!t)throw new Error(`O tipo ${e.name} não está registrado`);return new t}const Wt=e=>{const t=new pt(e),n=()=>t.getValue();return{value$:t.asObservable(),select:u=>t.asObservable().pipe(Y(c=>u(c)),ve()),value:n,patch:u=>{t.next({...n(),...u})},update:(u,c)=>{t.next({...n(),[u]:c})},set:u=>t.next(u)}},$=class ${constructor(){y(this,"map",new Map);y(this,"_events",new de);y(this,"events$",this._events.asObservable());y(this,"name",crypto.randomUUID())}static incSeq(){this._SEQ++}static get SEQ(){return this._SEQ}on(t,n){this.map.set(t,n)}log(...t){$.incSeq(),console.log(`${$.SEQ}.`,...t)}};y($,"_SEQ",0);let O=$;const Jt={ice:{new:"Até agora nenhum par foi encontrado, tentarei uma nova oferta",checking:`Recebi um candidato remoto e estou verificando pares para ele, mas ainda não encontrei uma conexão...
    Ou as verificações de consentimento (RFC7675) falharam em todos os pares de candidatos anteriormente bem-sucedidos.
    Vou verificar e continuar reunindo informações`,disconnected:"Perdemos o transporte para estabelecer conexão, parece que a rede está instável",closed:"Perdemos o transporte para estabelecer conexão, parece que a rede está instável",failed:`Recebi a informação de que não há mais candidatos remotos, a verificação de todos os pares de candidatos
    e todos os pares falharam nas verificações de conectividade ou perderam o consentimento e nenhum candidato local foi coletado.
    Vou tentar uma nova oferta reiniciando o transporte para uma nova tentativa de busca por pares...`,completed:"Não há mais candidatos de transporte, a verificação foi concluída e encontramos um par",connected:"Encontramos um transporte utilizável, estamos conectados mas ainda estarei em busca de outros..."}};function I(e,t={},...n){const r=Object.assign(document.createElement(e),t);return r.append(...n),r}const Xt=e=>t=>{const n=new Date().toLocaleTimeString();e.append(I("dt",{innerText:n}),I("dd",{innerText:t}))},zt=["have-remote-offer","have-local-pranswer"],Zt=e=>zt.includes(e);function Nt(e,t=1){const n=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return`rgba(${n},${r},${o},${t})`}const en=(e,{color:t,opacity:n}={color:"#ffffff",opacity:.16})=>{const r=document.createElement("canvas"),o=new AudioContext,i=r.getContext("2d");i.fillStyle=Nt(t,n);const a=o.createMediaStreamSource(e),s=o.createAnalyser();a.connect(s);const u=s.frequencyBinCount,c=new Uint8Array(u);let f,d,l,m;const{width:g,height:p}=r,x=()=>{if(i&&e){i.clearRect(0,0,g,p),f=g;for(let A=0;A<f;A++)l=g/f,d=A*(l+2),m=-c[A]/1.6,i.fillRect(d,p,l,m)}};let w=-1;const E=()=>{w=requestAnimationFrame(E),s.getByteFrequencyData(c),x()};return{canvas:r,renderLoop:E,animationFrame:w,disable:()=>{e.getTracks().forEach(A=>A.enabled=!1),cancelAnimationFrame(w),o.suspend()}}},tn=async(e,t)=>{const n=await e.createAnswer(t);return await e.setLocalDescription(n),n},F=async(e,t)=>{const n=await e.createOffer(t);return await e.setLocalDescription(n),n};function be(...e){const t=n=>!!e.find(r=>n instanceof r);return n=>n.pipe(Q(t))}function nn(e=-3,t=3){return Math.random()*(t-e)+e}const rn=e=>document.querySelector(e),on=e=>navigator.mediaDevices.getUserMedia(e||{audio:!0});function xe(e,t,n,r){const o=t*e.sampleRate,i=(t-2*n)*e.sampleRate,a=o+i,s=e.createBuffer(1,a,e.sampleRate),u=s.getChannelData(0);for(let c=0;c<o;++c)r?u[c]=(o-c)/a:u[c]=c/o;for(let c=o;c<a;++c)u[c]=0;return s}function an(e,t,n){const r=t*e.sampleRate,o=(t-2*n)*e.sampleRate,i=r+o,a=e.createBuffer(1,i,e.sampleRate),s=a.getChannelData(0),u=n*e.sampleRate,c=u,f=r-u;for(let d=0;d<r;++d){let l;d<c?l=Math.sqrt(d/u):d>=f?l=Math.sqrt(1-(d-f)/u):l=1,s[d]=l}for(let d=r;d<i;++d)s[d]=0;return a}class cn{constructor(t,n=.1,r=.05,o=.1){y(this,"input");y(this,"output");y(this,"shiftDownBuffer");y(this,"shiftUpBuffer");y(this,"mod1");y(this,"mod2");y(this,"mod1Gain");y(this,"mod2Gain");y(this,"mod3Gain");y(this,"mod4Gain");y(this,"modGain1");y(this,"modGain2");y(this,"fade1");y(this,"fade2");y(this,"mix1");y(this,"mix2");y(this,"delay1");y(this,"delay2");this.context=t,this.bufferTime=n,this.fadeTime=r,this.delayTime=o;const i=t.createGain(),a=t.createGain();this.input=i,this.output=a;const s=t.createBufferSource(),u=t.createBufferSource(),c=t.createBufferSource(),f=t.createBufferSource();this.shiftDownBuffer=xe(t,n,r,!1),this.shiftUpBuffer=xe(t,n,r,!0),s.buffer=this.shiftDownBuffer,u.buffer=this.shiftDownBuffer,c.buffer=this.shiftUpBuffer,f.buffer=this.shiftUpBuffer,s.loop=!0,u.loop=!0,c.loop=!0,f.loop=!0;const d=t.createGain(),l=t.createGain(),m=t.createGain();m.gain.value=0;const g=t.createGain();g.gain.value=0,s.connect(d),u.connect(l),c.connect(m),f.connect(g);const p=t.createGain(),x=t.createGain(),w=t.createDelay(),E=t.createDelay();d.connect(p),l.connect(x),m.connect(p),g.connect(x),p.connect(w.delayTime),x.connect(E.delayTime);const k=t.createBufferSource(),A=t.createBufferSource(),ge=an(t,n,r);k.buffer=ge,A.buffer=ge,k.loop=!0,A.loop=!0;const j=t.createGain(),q=t.createGain();j.gain.value=0,q.gain.value=0,k.connect(j.gain),A.connect(q.gain),i.connect(w),i.connect(E),w.connect(j),E.connect(q),j.connect(a),q.connect(a);const K=t.currentTime+.05,ee=K+n-r;s.start(K),u.start(ee),c.start(K),f.start(ee),k.start(K),A.start(ee),this.mod1=s,this.mod2=u,this.mod1Gain=d,this.mod2Gain=l,this.mod3Gain=m,this.mod4Gain=g,this.modGain1=p,this.modGain2=x,this.fade1=k,this.fade2=A,this.mix1=j,this.mix2=q,this.delay1=w,this.delay2=E,this.setDelay(o)}setDelay(t){this.modGain1.gain.setTargetAtTime(.5*t,0,.01),this.modGain2.gain.setTargetAtTime(.5*t,0,.01)}setPitchOffset(t){t>0?(this.mod1Gain.gain.value=0,this.mod2Gain.gain.value=0,this.mod3Gain.gain.value=1,this.mod4Gain.gain.value=1):(this.mod1Gain.gain.value=1,this.mod2Gain.gain.value=1,this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0),this.setDelay(this.delayTime*Math.abs(t))}}const sn=e=>{const t=new AudioContext,n=t.createMediaStreamSource(e),r=t.createDelay();r.delayTime.value=0,n.connect(r);const o=new cn(t);o.setPitchOffset(1.6),r.connect(o.input);const i=t.createMediaStreamDestination();o.output.connect(i);const a=document.createElement("input");return a.type="range",a.min="-3",a.max="3",a.value=String(nn(-3,3)),a.oninput=()=>{o.setPitchOffset(a.valueAsNumber)},{input:a,destination:i}};class un extends O{constructor(){super();y(this,"provider",new BroadcastChannel("signaling"));this.provider.onmessage=({data:n})=>{if(n.name!==this.name){O.incSeq();const r=this.map.get(n.type);this._events.next(new r(n.payload))}}}onOpen(n){n(new CustomEvent("open"))}emit(n,r){O.incSeq(),this.provider.postMessage({sequence:O.SEQ,payload:r.toJSON(),name:this.name,type:n})}}Ht(O,un);const h=Kt(O);h.on("offer",G);h.on("answer",ye);h.on("candidate",me);const re=new MediaStream;let J;const v=new RTCPeerConnection,ze={autoplay:!0},oe=I("audio",ze),D=I("audio",ze),Ze=I("output",{innerText:"guentae, rapidão"});document.body.appendChild(Ze);v.onicecandidate=e=>{if(e.candidate){const t=new me(e.candidate);h.emit("candidate",t),h.log("Enviei meus candidatos")}};const H=Wt({signaling:"closed",connection:"new",iceConnection:"closed",iceGathering:"new"});v.onsignalingstatechange=()=>{H.update("signaling",v.signalingState)};v.oniceconnectionstatechange=()=>{H.update("iceConnection",v.iceConnectionState)};v.onconnectionstatechange=()=>{H.update("connection",v.connectionState),Ze.innerText=v.connectionState};v.onicegatheringstatechange=()=>{H.update("iceGathering",v.iceGatheringState)};h.events$.pipe(be(G),Y(async e=>(h.log("Recebi uma oferta"),await v.setRemoteDescription(e),h.log("Configurei uma descrição remota"),e))).subscribe(async e=>{if(await e,Zt(v.signalingState)){h.log("Aceitei uma oferta");const t=await tn(v);h.log("Configurei uma descrição local"),h.emit("answer",new ye(t)),h.log("Enviei uma resposta")}});h.events$.pipe(be(ye)).subscribe(async e=>{h.log("Recebi uma resposta"),v.setRemoteDescription(e),h.log("Configurei uma descrição remota")});h.events$.pipe(be(me)).subscribe(async e=>{v.remoteDescription&&await v.addIceCandidate(e)});v.onnegotiationneeded=async()=>{h.log("Vamos negociar"),h.onOpen(async()=>{const e=await F(v);h.emit("offer",new G(e)),h.log("Enviei uma oferta")})};const N=H.select(e=>e.connection),ln=N.pipe(Q(e=>e==="connected")),fn=N.pipe(Q(e=>e==="disconnected"),ve((e,t)=>e!=="disconnected"&&t==="connecting")),dn=N.pipe(Q(e=>e==="disconnected"),ve((e,t)=>e!=="disconnected"&&t==="disconnected")),hn=N.pipe(Q(e=>e==="disconnected"));ln.subscribe(()=>{document.body.appendChild(D),D.paused&&D.play()});hn.subscribe(()=>{D.remove()});fn.subscribe(async()=>{const e=await F(v);h.emit("offer",new G(e)),h.log("Fomos desconectados, enviei uma nova oferta")});dn.subscribe(async()=>{const e=await F(v);h.emit("offer",new G(e)),h.log("Fomos desconectados, enviei uma nova oferta")});$t(5e3).pipe(Yt(3e3),Y(()=>v.iceConnectionState)).subscribe(async e=>{let t,n;if(J===void 0&&(J=I("dl",{id:"log"}),n=Xt(J),document.body.append(J)),e){const r=Jt.ice[e];t!==r&&n(r),rn("dd:last-child").scrollIntoView({behavior:"smooth",block:"end"})}switch(e){case"new":{const r=await F(v);h.emit("offer",new G(r)),h.log("Enviei uma nova oferta");break}case"failed":{const o=await F(v,{iceRestart:!0});h.emit("offer",new G(o)),h.log("Enviei uma oferta");break}}});v.ontrack=({track:e})=>{if(e){re.addTrack(e),D.srcObject=re,D.autoplay=!0;const t=en(re);document.body.appendChild(t.canvas),t.renderLoop()}};on().then(e=>{oe.srcObject=e,oe.muted=!0,document.body.appendChild(oe);const{input:t,destination:n}=sn(e),[r]=n.stream.getAudioTracks();v.addTrack(r);const o=I("h2",{innerText:"🧌",ariaLabel:"Monstro",title:"Monstro"}),i=I("h2",{innerText:"🐩",ariaLabel:"Poodle",title:"Poodle"}),a=I("section");a.append(o,t,i),document.body.appendChild(a);const s=I("input",{type:"checkbox",id:"pitch"});s.onchange=()=>{if(s.checked){const[c]=e.getAudioTracks();_e(c)}else{const[c]=n.stream.getAudioTracks();_e(c)}},queueMicrotask(()=>s.click());const u=I("label",{htmlFor:"pitch",innerText:"Pitch",title:"Pitch"},s);document.body.append(u)});const _e=e=>{const t=v.getSenders().find(({track:n})=>n&&n.kind==="audio");t==null||t.replaceTrack(e)};url.innerText=origin;url.target="_blenk";url.href=origin;
